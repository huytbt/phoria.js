!function(n){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports="undefined"!=typeof window?window:n:t.exports=exports,function(n){if(!t)var t=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!e)var e=Math.random;var u={};u.setMatrixArrayType=function(n){r=n},"undefined"!=typeof n&&(n.glMatrix=u);var a=Math.PI/180;u.toRadian=function(n){return n*a};var i={};i.create=function(){var n=new r(2);return n[0]=0,n[1]=0,n},i.clone=function(n){var t=new r(2);return t[0]=n[0],t[1]=n[1],t},i.fromValues=function(n,t){var e=new r(2);return e[0]=n,e[1]=t,e},i.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n},i.set=function(n,t,r){return n[0]=t,n[1]=r,n},i.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n},i.subtract=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n},i.sub=i.subtract,i.multiply=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n},i.mul=i.multiply,i.divide=function(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n},i.div=i.divide,i.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n},i.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n},i.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},i.scaleAndAdd=function(n,t,r,e){return n[0]=t[0]+r[0]*e,n[1]=t[1]+r[1]*e,n},i.distance=function(n,t){var r=t[0]-n[0],e=t[1]-n[1];return Math.sqrt(r*r+e*e)},i.dist=i.distance,i.squaredDistance=function(n,t){var r=t[0]-n[0],e=t[1]-n[1];return r*r+e*e},i.sqrDist=i.squaredDistance,i.length=function(n){var t=n[0],r=n[1];return Math.sqrt(t*t+r*r)},i.len=i.length,i.squaredLength=function(n){var t=n[0],r=n[1];return t*t+r*r},i.sqrLen=i.squaredLength,i.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n},i.normalize=function(n,t){var r=t[0],e=t[1],u=r*r+e*e;return u>0&&(u=1/Math.sqrt(u),n[0]=t[0]*u,n[1]=t[1]*u),n},i.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]},i.cross=function(n,t,r){var e=t[0]*r[1]-t[1]*r[0];return n[0]=n[1]=0,n[2]=e,n},i.lerp=function(n,t,r,e){var u=t[0],a=t[1];return n[0]=u+e*(r[0]-u),n[1]=a+e*(r[1]-a),n},i.random=function(n,t){t=t||1;var r=2*e()*Math.PI;return n[0]=Math.cos(r)*t,n[1]=Math.sin(r)*t,n},i.transformMat2=function(n,t,r){var e=t[0],u=t[1];return n[0]=r[0]*e+r[2]*u,n[1]=r[1]*e+r[3]*u,n},i.transformMat2d=function(n,t,r){var e=t[0],u=t[1];return n[0]=r[0]*e+r[2]*u+r[4],n[1]=r[1]*e+r[3]*u+r[5],n},i.transformMat3=function(n,t,r){var e=t[0],u=t[1];return n[0]=r[0]*e+r[3]*u+r[6],n[1]=r[1]*e+r[4]*u+r[7],n},i.transformMat4=function(n,t,r){var e=t[0],u=t[1];return n[0]=r[0]*e+r[4]*u+r[12],n[1]=r[1]*e+r[5]*u+r[13],n},i.forEach=function(){var n=i.create();return function(t,r,e,u,a,i){var o,c;for(r||(r=2),e||(e=0),c=u?Math.min(u*r+e,t.length):t.length,o=e;o<c;o+=r)n[0]=t[o],n[1]=t[o+1],a(n,n,i),t[o]=n[0],t[o+1]=n[1];return t}}(),i.str=function(n){return"vec2("+n[0]+", "+n[1]+")"},"undefined"!=typeof n&&(n.vec2=i);var o={};o.create=function(){var n=new r(3);return n[0]=0,n[1]=0,n[2]=0,n},o.clone=function(n){var t=new r(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},o.fromValues=function(n,t,e){var u=new r(3);return u[0]=n,u[1]=t,u[2]=e,u},o.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},o.set=function(n,t,r,e){return n[0]=t,n[1]=r,n[2]=e,n},o.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},o.subtract=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},o.sub=o.subtract,o.multiply=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n},o.mul=o.multiply,o.divide=function(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n},o.div=o.divide,o.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n},o.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n},o.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},o.scaleAndAdd=function(n,t,r,e){return n[0]=t[0]+r[0]*e,n[1]=t[1]+r[1]*e,n[2]=t[2]+r[2]*e,n},o.distance=function(n,t){var r=t[0]-n[0],e=t[1]-n[1],u=t[2]-n[2];return Math.sqrt(r*r+e*e+u*u)},o.dist=o.distance,o.squaredDistance=function(n,t){var r=t[0]-n[0],e=t[1]-n[1],u=t[2]-n[2];return r*r+e*e+u*u},o.sqrDist=o.squaredDistance,o.length=function(n){var t=n[0],r=n[1],e=n[2];return Math.sqrt(t*t+r*r+e*e)},o.len=o.length,o.squaredLength=function(n){var t=n[0],r=n[1],e=n[2];return t*t+r*r+e*e},o.sqrLen=o.squaredLength,o.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n},o.normalize=function(n,t){var r=t[0],e=t[1],u=t[2],a=r*r+e*e+u*u;return a>0&&(a=1/Math.sqrt(a),n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a),n},o.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},o.cross=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=r[0],o=r[1],c=r[2];return n[0]=u*c-a*o,n[1]=a*i-e*c,n[2]=e*o-u*i,n},o.lerp=function(n,t,r,e){var u=t[0],a=t[1],i=t[2];return n[0]=u+e*(r[0]-u),n[1]=a+e*(r[1]-a),n[2]=i+e*(r[2]-i),n},o.random=function(n,t){t=t||1;var r=2*e()*Math.PI,u=2*e()-1,a=Math.sqrt(1-u*u)*t;return n[0]=Math.cos(r)*a,n[1]=Math.sin(r)*a,n[2]=u*t,n},o.transformMat4=function(n,t,r){var e=t[0],u=t[1],a=t[2];return n[0]=r[0]*e+r[4]*u+r[8]*a+r[12],n[1]=r[1]*e+r[5]*u+r[9]*a+r[13],n[2]=r[2]*e+r[6]*u+r[10]*a+r[14],n},o.transformMat3=function(n,t,r){var e=t[0],u=t[1],a=t[2];return n[0]=e*r[0]+u*r[3]+a*r[6],n[1]=e*r[1]+u*r[4]+a*r[7],n[2]=e*r[2]+u*r[5]+a*r[8],n},o.transformQuat=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=r[0],o=r[1],c=r[2],f=r[3],s=f*e+o*a-c*u,v=f*u+c*e-i*a,l=f*a+i*u-o*e,d=-i*e-o*u-c*a;return n[0]=s*f+d*-i+v*-c-l*-o,n[1]=v*f+d*-o+l*-i-s*-c,n[2]=l*f+d*-c+s*-o-v*-i,n},o.forEach=function(){var n=o.create();return function(t,r,e,u,a,i){var o,c;for(r||(r=3),e||(e=0),c=u?Math.min(u*r+e,t.length):t.length,o=e;o<c;o+=r)n[0]=t[o],n[1]=t[o+1],n[2]=t[o+2],a(n,n,i),t[o]=n[0],t[o+1]=n[1],t[o+2]=n[2];return t}}(),o.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"},"undefined"!=typeof n&&(n.vec3=o);var c={};c.create=function(){var n=new r(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},c.clone=function(n){var t=new r(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},c.fromValues=function(n,t,e,u){var a=new r(4);return a[0]=n,a[1]=t,a[2]=e,a[3]=u,a},c.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},c.set=function(n,t,r,e,u){return n[0]=t,n[1]=r,n[2]=e,n[3]=u,n},c.add=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},c.subtract=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n},c.sub=c.subtract,c.multiply=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},c.mul=c.multiply,c.divide=function(n,t,r){return n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n[3]=t[3]/r[3],n},c.div=c.divide,c.min=function(n,t,r){return n[0]=Math.min(t[0],r[0]),n[1]=Math.min(t[1],r[1]),n[2]=Math.min(t[2],r[2]),n[3]=Math.min(t[3],r[3]),n},c.max=function(n,t,r){return n[0]=Math.max(t[0],r[0]),n[1]=Math.max(t[1],r[1]),n[2]=Math.max(t[2],r[2]),n[3]=Math.max(t[3],r[3]),n},c.scale=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},c.scaleAndAdd=function(n,t,r,e){return n[0]=t[0]+r[0]*e,n[1]=t[1]+r[1]*e,n[2]=t[2]+r[2]*e,n[3]=t[3]+r[3]*e,n},c.distance=function(n,t){var r=t[0]-n[0],e=t[1]-n[1],u=t[2]-n[2],a=t[3]-n[3];return Math.sqrt(r*r+e*e+u*u+a*a)},c.dist=c.distance,c.squaredDistance=function(n,t){var r=t[0]-n[0],e=t[1]-n[1],u=t[2]-n[2],a=t[3]-n[3];return r*r+e*e+u*u+a*a},c.sqrDist=c.squaredDistance,c.length=function(n){var t=n[0],r=n[1],e=n[2],u=n[3];return Math.sqrt(t*t+r*r+e*e+u*u)},c.len=c.length,c.squaredLength=function(n){var t=n[0],r=n[1],e=n[2],u=n[3];return t*t+r*r+e*e+u*u},c.sqrLen=c.squaredLength,c.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n},c.normalize=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=r*r+e*e+u*u+a*a;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i),n},c.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},c.lerp=function(n,t,r,e){var u=t[0],a=t[1],i=t[2],o=t[3];return n[0]=u+e*(r[0]-u),n[1]=a+e*(r[1]-a),n[2]=i+e*(r[2]-i),n[3]=o+e*(r[3]-o),n},c.random=function(n,t){return t=t||1,n[0]=e(),n[1]=e(),n[2]=e(),n[3]=e(),c.normalize(n,n),c.scale(n,n,t),n},c.transformMat4=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3];return n[0]=r[0]*e+r[4]*u+r[8]*a+r[12]*i,n[1]=r[1]*e+r[5]*u+r[9]*a+r[13]*i,n[2]=r[2]*e+r[6]*u+r[10]*a+r[14]*i,n[3]=r[3]*e+r[7]*u+r[11]*a+r[15]*i,n},c.transformQuat=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=r[0],o=r[1],c=r[2],f=r[3],s=f*e+o*a-c*u,v=f*u+c*e-i*a,l=f*a+i*u-o*e,d=-i*e-o*u-c*a;return n[0]=s*f+d*-i+v*-c-l*-o,n[1]=v*f+d*-o+l*-i-s*-c,n[2]=l*f+d*-c+s*-o-v*-i,n},c.forEach=function(){var n=c.create();return function(t,r,e,u,a,i){var o,c;for(r||(r=4),e||(e=0),c=u?Math.min(u*r+e,t.length):t.length,o=e;o<c;o+=r)n[0]=t[o],n[1]=t[o+1],n[2]=t[o+2],n[3]=t[o+3],a(n,n,i),t[o]=n[0],t[o+1]=n[1],t[o+2]=n[2],t[o+3]=n[3];return t}}(),c.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},"undefined"!=typeof n&&(n.vec4=c);var f={};f.create=function(){var n=new r(4);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},f.clone=function(n){var t=new r(4);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},f.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},f.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},f.transpose=function(n,t){if(n===t){var r=t[1];n[1]=t[2],n[2]=r}else n[0]=t[0],n[1]=t[2],n[2]=t[1],n[3]=t[3];return n},f.invert=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=r*a-u*e;return i?(i=1/i,n[0]=a*i,n[1]=-e*i,n[2]=-u*i,n[3]=r*i,n):null},f.adjoint=function(n,t){var r=t[0];return n[0]=t[3],n[1]=-t[1],n[2]=-t[2],n[3]=r,n},f.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},f.multiply=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=r[0],c=r[1],f=r[2],s=r[3];return n[0]=e*o+u*f,n[1]=e*c+u*s,n[2]=a*o+i*f,n[3]=a*c+i*s,n},f.mul=f.multiply,f.rotate=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=Math.sin(r),c=Math.cos(r);return n[0]=e*c+u*o,n[1]=e*-o+u*c,n[2]=a*c+i*o,n[3]=a*-o+i*c,n},f.scale=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=r[0],c=r[1];return n[0]=e*o,n[1]=u*c,n[2]=a*o,n[3]=i*c,n},f.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},"undefined"!=typeof n&&(n.mat2=f);var s={};s.create=function(){var n=new r(6);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},s.clone=function(n){var t=new r(6);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},s.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},s.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},s.invert=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=t[4],o=t[5],c=r*a-e*u;return c?(c=1/c,n[0]=a*c,n[1]=-e*c,n[2]=-u*c,n[3]=r*c,n[4]=(u*o-a*i)*c,n[5]=(e*i-r*o)*c,n):null},s.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},s.multiply=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=r[0],s=r[1],v=r[2],l=r[3],d=r[4],h=r[5];return n[0]=e*f+u*v,n[1]=e*s+u*l,n[2]=a*f+i*v,n[3]=a*s+i*l,n[4]=f*o+v*c+d,n[5]=s*o+l*c+h,n},s.mul=s.multiply,s.rotate=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=Math.sin(r),s=Math.cos(r);return n[0]=e*s+u*f,n[1]=-e*f+u*s,n[2]=a*s+i*f,n[3]=-a*f+s*i,n[4]=s*o+f*c,n[5]=s*c-f*o,n},s.scale=function(n,t,r){var e=r[0],u=r[1];return n[0]=t[0]*e,n[1]=t[1]*u,n[2]=t[2]*e,n[3]=t[3]*u,n[4]=t[4]*e,n[5]=t[5]*u,n},s.translate=function(n,t,r){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4]+r[0],n[5]=t[5]+r[1],n},s.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},"undefined"!=typeof n&&(n.mat2d=s);var v={};v.create=function(){var n=new r(9);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},v.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},v.clone=function(n){var t=new r(9);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},v.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},v.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},v.transpose=function(n,t){if(n===t){var r=t[1],e=t[2],u=t[5];n[1]=t[3],n[2]=t[6],n[3]=r,n[5]=t[7],n[6]=e,n[7]=u}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},v.invert=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=t[4],o=t[5],c=t[6],f=t[7],s=t[8],v=s*i-o*f,l=-s*a+o*c,d=f*a-i*c,h=r*v+e*l+u*d;return h?(h=1/h,n[0]=v*h,n[1]=(-s*e+u*f)*h,n[2]=(o*e-u*i)*h,n[3]=l*h,n[4]=(s*r-u*c)*h,n[5]=(-o*r+u*a)*h,n[6]=d*h,n[7]=(-f*r+e*c)*h,n[8]=(i*r-e*a)*h,n):null},v.adjoint=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=t[4],o=t[5],c=t[6],f=t[7],s=t[8];return n[0]=i*s-o*f,n[1]=u*f-e*s,n[2]=e*o-u*i,n[3]=o*c-a*s,n[4]=r*s-u*c,n[5]=u*a-r*o,n[6]=a*f-i*c,n[7]=e*c-r*f,n[8]=r*i-e*a,n},v.determinant=function(n){var t=n[0],r=n[1],e=n[2],u=n[3],a=n[4],i=n[5],o=n[6],c=n[7],f=n[8];return t*(f*a-i*c)+r*(-f*u+i*o)+e*(c*u-a*o)},v.multiply=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],l=r[0],d=r[1],h=r[2],m=r[3],M=r[4],p=r[5],y=r[6],q=r[7],g=r[8];return n[0]=l*e+d*i+h*f,n[1]=l*u+d*o+h*s,n[2]=l*a+d*c+h*v,n[3]=m*e+M*i+p*f,n[4]=m*u+M*o+p*s,n[5]=m*a+M*c+p*v,n[6]=y*e+q*i+g*f,n[7]=y*u+q*o+g*s,n[8]=y*a+q*c+g*v,n},v.mul=v.multiply,v.translate=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],l=r[0],d=r[1];return n[0]=e,n[1]=u,n[2]=a,n[3]=i,n[4]=o,n[5]=c,n[6]=l*e+d*i+f,n[7]=l*u+d*o+s,n[8]=l*a+d*c+v,n},v.rotate=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],l=Math.sin(r),d=Math.cos(r);return n[0]=d*e+l*i,n[1]=d*u+l*o,n[2]=d*a+l*c,n[3]=d*i-l*e,n[4]=d*o-l*u,n[5]=d*c-l*a,n[6]=f,n[7]=s,n[8]=v,n},v.scale=function(n,t,r){var e=r[0],u=r[1];return n[0]=e*t[0],n[1]=e*t[1],n[2]=e*t[2],n[3]=u*t[3],n[4]=u*t[4],n[5]=u*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},v.fromMat2d=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=0,n[3]=t[2],n[4]=t[3],n[5]=0,n[6]=t[4],n[7]=t[5],n[8]=1,n},v.fromQuat=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=r+r,o=e+e,c=u+u,f=r*i,s=e*i,v=e*o,l=u*i,d=u*o,h=u*c,m=a*i,M=a*o,p=a*c;return n[0]=1-v-h,n[3]=s-p,n[6]=l+M,n[1]=s+p,n[4]=1-f-h,n[7]=d-m,n[2]=l-M,n[5]=d+m,n[8]=1-f-v,n},v.normalFromMat4=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=t[4],o=t[5],c=t[6],f=t[7],s=t[8],v=t[9],l=t[10],d=t[11],h=t[12],m=t[13],M=t[14],p=t[15],y=r*o-e*i,q=r*c-u*i,g=r*f-a*i,x=e*c-u*o,w=e*f-a*o,A=u*f-a*c,b=s*m-v*h,L=s*M-l*h,z=s*p-d*h,D=v*M-l*m,V=v*p-d*m,j=l*p-d*M,I=y*j-q*V+g*D+x*z-w*L+A*b;return I?(I=1/I,n[0]=(o*j-c*V+f*D)*I,n[1]=(c*z-i*j-f*L)*I,n[2]=(i*V-o*z+f*b)*I,n[3]=(u*V-e*j-a*D)*I,n[4]=(r*j-u*z+a*L)*I,n[5]=(e*z-r*V-a*b)*I,n[6]=(m*A-M*w+p*x)*I,n[7]=(M*g-h*A-p*q)*I,n[8]=(h*w-m*g+p*y)*I,n):null},v.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},"undefined"!=typeof n&&(n.mat3=v);var l={};l.create=function(){var n=new r(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.clone=function(n){var t=new r(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},l.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},l.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.transpose=function(n,t){if(n===t){var r=t[1],e=t[2],u=t[3],a=t[6],i=t[7],o=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=r,n[6]=t[9],n[7]=t[13],n[8]=e,n[9]=a,n[11]=t[14],n[12]=u,n[13]=i,n[14]=o}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n},l.invert=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=t[4],o=t[5],c=t[6],f=t[7],s=t[8],v=t[9],l=t[10],d=t[11],h=t[12],m=t[13],M=t[14],p=t[15],y=r*o-e*i,q=r*c-u*i,g=r*f-a*i,x=e*c-u*o,w=e*f-a*o,A=u*f-a*c,b=s*m-v*h,L=s*M-l*h,z=s*p-d*h,D=v*M-l*m,V=v*p-d*m,j=l*p-d*M,I=y*j-q*V+g*D+x*z-w*L+A*b;return I?(I=1/I,n[0]=(o*j-c*V+f*D)*I,n[1]=(u*V-e*j-a*D)*I,n[2]=(m*A-M*w+p*x)*I,n[3]=(l*w-v*A-d*x)*I,n[4]=(c*z-i*j-f*L)*I,n[5]=(r*j-u*z+a*L)*I,n[6]=(M*g-h*A-p*q)*I,n[7]=(s*A-l*g+d*q)*I,n[8]=(i*V-o*z+f*b)*I,n[9]=(e*z-r*V-a*b)*I,n[10]=(h*w-m*g+p*y)*I,n[11]=(v*g-s*w-d*y)*I,n[12]=(o*L-i*D-c*b)*I,n[13]=(r*D-e*L+u*b)*I,n[14]=(m*q-h*x-M*y)*I,n[15]=(s*x-v*q+l*y)*I,n):null},l.adjoint=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=t[4],o=t[5],c=t[6],f=t[7],s=t[8],v=t[9],l=t[10],d=t[11],h=t[12],m=t[13],M=t[14],p=t[15];return n[0]=o*(l*p-d*M)-v*(c*p-f*M)+m*(c*d-f*l),n[1]=-(e*(l*p-d*M)-v*(u*p-a*M)+m*(u*d-a*l)),n[2]=e*(c*p-f*M)-o*(u*p-a*M)+m*(u*f-a*c),n[3]=-(e*(c*d-f*l)-o*(u*d-a*l)+v*(u*f-a*c)),n[4]=-(i*(l*p-d*M)-s*(c*p-f*M)+h*(c*d-f*l)),n[5]=r*(l*p-d*M)-s*(u*p-a*M)+h*(u*d-a*l),n[6]=-(r*(c*p-f*M)-i*(u*p-a*M)+h*(u*f-a*c)),n[7]=r*(c*d-f*l)-i*(u*d-a*l)+s*(u*f-a*c),n[8]=i*(v*p-d*m)-s*(o*p-f*m)+h*(o*d-f*v),n[9]=-(r*(v*p-d*m)-s*(e*p-a*m)+h*(e*d-a*v)),n[10]=r*(o*p-f*m)-i*(e*p-a*m)+h*(e*f-a*o),n[11]=-(r*(o*d-f*v)-i*(e*d-a*v)+s*(e*f-a*o)),n[12]=-(i*(v*M-l*m)-s*(o*M-c*m)+h*(o*l-c*v)),n[13]=r*(v*M-l*m)-s*(e*M-u*m)+h*(e*l-u*v),n[14]=-(r*(o*M-c*m)-i*(e*M-u*m)+h*(e*c-u*o)),n[15]=r*(o*l-c*v)-i*(e*l-u*v)+s*(e*c-u*o),n},l.determinant=function(n){var t=n[0],r=n[1],e=n[2],u=n[3],a=n[4],i=n[5],o=n[6],c=n[7],f=n[8],s=n[9],v=n[10],l=n[11],d=n[12],h=n[13],m=n[14],M=n[15],p=t*i-r*a,y=t*o-e*a,q=t*c-u*a,g=r*o-e*i,x=r*c-u*i,w=e*c-u*o,A=f*h-s*d,b=f*m-v*d,L=f*M-l*d,z=s*m-v*h,D=s*M-l*h,V=v*M-l*m;return p*V-y*D+q*z+g*L-x*b+w*A},l.multiply=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],l=t[9],d=t[10],h=t[11],m=t[12],M=t[13],p=t[14],y=t[15],q=r[0],g=r[1],x=r[2],w=r[3];return n[0]=q*e+g*o+x*v+w*m,n[1]=q*u+g*c+x*l+w*M,n[2]=q*a+g*f+x*d+w*p,n[3]=q*i+g*s+x*h+w*y,q=r[4],g=r[5],x=r[6],w=r[7],n[4]=q*e+g*o+x*v+w*m,n[5]=q*u+g*c+x*l+w*M,n[6]=q*a+g*f+x*d+w*p,n[7]=q*i+g*s+x*h+w*y,q=r[8],g=r[9],x=r[10],w=r[11],n[8]=q*e+g*o+x*v+w*m,n[9]=q*u+g*c+x*l+w*M,n[10]=q*a+g*f+x*d+w*p,n[11]=q*i+g*s+x*h+w*y,q=r[12],g=r[13],x=r[14],w=r[15],n[12]=q*e+g*o+x*v+w*m,n[13]=q*u+g*c+x*l+w*M,n[14]=q*a+g*f+x*d+w*p,n[15]=q*i+g*s+x*h+w*y,n},l.mul=l.multiply,l.translate=function(n,t,r){var e,u,a,i,o,c,f,s,v,l,d,h,m=r[0],M=r[1],p=r[2];return t===n?(n[12]=t[0]*m+t[4]*M+t[8]*p+t[12],n[13]=t[1]*m+t[5]*M+t[9]*p+t[13],n[14]=t[2]*m+t[6]*M+t[10]*p+t[14],n[15]=t[3]*m+t[7]*M+t[11]*p+t[15]):(e=t[0],u=t[1],a=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],l=t[9],d=t[10],h=t[11],n[0]=e,n[1]=u,n[2]=a,n[3]=i,n[4]=o,n[5]=c,n[6]=f,n[7]=s,n[8]=v,n[9]=l,n[10]=d,n[11]=h,n[12]=e*m+o*M+v*p+t[12],n[13]=u*m+c*M+l*p+t[13],n[14]=a*m+f*M+d*p+t[14],n[15]=i*m+s*M+h*p+t[15]),n},l.scale=function(n,t,r){var e=r[0],u=r[1],a=r[2];return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n[4]=t[4]*u,n[5]=t[5]*u,n[6]=t[6]*u,n[7]=t[7]*u,n[8]=t[8]*a,n[9]=t[9]*a,n[10]=t[10]*a,n[11]=t[11]*a,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},l.rotate=function(n,r,e,u){var a,i,o,c,f,s,v,l,d,h,m,M,p,y,q,g,x,w,A,b,L,z,D,V,j=u[0],I=u[1],P=u[2],Q=Math.sqrt(j*j+I*I+P*P);return Math.abs(Q)<t?null:(Q=1/Q,j*=Q,I*=Q,P*=Q,a=Math.sin(e),i=Math.cos(e),o=1-i,c=r[0],f=r[1],s=r[2],v=r[3],l=r[4],d=r[5],h=r[6],m=r[7],M=r[8],p=r[9],y=r[10],q=r[11],g=j*j*o+i,x=I*j*o+P*a,w=P*j*o-I*a,A=j*I*o-P*a,b=I*I*o+i,L=P*I*o+j*a,z=j*P*o+I*a,D=I*P*o-j*a,V=P*P*o+i,n[0]=c*g+l*x+M*w,n[1]=f*g+d*x+p*w,n[2]=s*g+h*x+y*w,n[3]=v*g+m*x+q*w,n[4]=c*A+l*b+M*L,n[5]=f*A+d*b+p*L,n[6]=s*A+h*b+y*L,n[7]=v*A+m*b+q*L,n[8]=c*z+l*D+M*V,n[9]=f*z+d*D+p*V,n[10]=s*z+h*D+y*V,n[11]=v*z+m*D+q*V,r!==n&&(n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n)},l.rotateX=function(n,t,r){var e=Math.sin(r),u=Math.cos(r),a=t[4],i=t[5],o=t[6],c=t[7],f=t[8],s=t[9],v=t[10],l=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=a*u+f*e,n[5]=i*u+s*e,n[6]=o*u+v*e,n[7]=c*u+l*e,n[8]=f*u-a*e,n[9]=s*u-i*e,n[10]=v*u-o*e,n[11]=l*u-c*e,n},l.rotateY=function(n,t,r){var e=Math.sin(r),u=Math.cos(r),a=t[0],i=t[1],o=t[2],c=t[3],f=t[8],s=t[9],v=t[10],l=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=a*u-f*e,n[1]=i*u-s*e,n[2]=o*u-v*e,n[3]=c*u-l*e,n[8]=a*e+f*u,n[9]=i*e+s*u,n[10]=o*e+v*u,n[11]=c*e+l*u,n},l.rotateZ=function(n,t,r){var e=Math.sin(r),u=Math.cos(r),a=t[0],i=t[1],o=t[2],c=t[3],f=t[4],s=t[5],v=t[6],l=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=a*u+f*e,n[1]=i*u+s*e,n[2]=o*u+v*e,n[3]=c*u+l*e,n[4]=f*u-a*e,n[5]=s*u-i*e,n[6]=v*u-o*e,n[7]=l*u-c*e,n},l.fromRotationTranslation=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=e+e,c=u+u,f=a+a,s=e*o,v=e*c,l=e*f,d=u*c,h=u*f,m=a*f,M=i*o,p=i*c,y=i*f;return n[0]=1-(d+m),n[1]=v+y,n[2]=l-p,n[3]=0,n[4]=v-y,n[5]=1-(s+m),n[6]=h+M,n[7]=0,n[8]=l+p,n[9]=h-M,n[10]=1-(s+d),n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},l.fromQuat=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=r+r,o=e+e,c=u+u,f=r*i,s=e*i,v=e*o,l=u*i,d=u*o,h=u*c,m=a*i,M=a*o,p=a*c;return n[0]=1-v-h,n[1]=s+p,n[2]=l-M,n[3]=0,n[4]=s-p,n[5]=1-f-h,n[6]=d+m,n[7]=0,n[8]=l+M,n[9]=d-m,n[10]=1-f-v,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.frustum=function(n,t,r,e,u,a,i){var o=1/(r-t),c=1/(u-e),f=1/(a-i);return n[0]=2*a*o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*a*c,n[6]=0,n[7]=0,n[8]=(r+t)*o,n[9]=(u+e)*c,n[10]=(i+a)*f,n[11]=-1,n[12]=0,n[13]=0,n[14]=i*a*2*f,n[15]=0,n},l.perspective=function(n,t,r,e,u){var a=1/Math.tan(t/2),i=1/(e-u);return n[0]=a/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(u+e)*i,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*u*e*i,n[15]=0,n},l.ortho=function(n,t,r,e,u,a,i){var o=1/(t-r),c=1/(e-u),f=1/(a-i);return n[0]=-2*o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*f,n[11]=0,n[12]=(t+r)*o,n[13]=(u+e)*c,n[14]=(i+a)*f,n[15]=1,n},l.lookAt=function(n,r,e,u){var a,i,o,c,f,s,v,d,h,m,M=r[0],p=r[1],y=r[2],q=u[0],g=u[1],x=u[2],w=e[0],A=e[1],b=e[2];return Math.abs(M-w)<t&&Math.abs(p-A)<t&&Math.abs(y-b)<t?l.identity(n):(v=M-w,d=p-A,h=y-b,m=1/Math.sqrt(v*v+d*d+h*h),v*=m,d*=m,h*=m,a=g*h-x*d,i=x*v-q*h,o=q*d-g*v,m=Math.sqrt(a*a+i*i+o*o),m?(m=1/m,a*=m,i*=m,o*=m):(a=0,i=0,o=0),c=d*o-h*i,f=h*a-v*o,s=v*i-d*a,m=Math.sqrt(c*c+f*f+s*s),m?(m=1/m,c*=m,f*=m,s*=m):(c=0,f=0,s=0),n[0]=a,n[1]=c,n[2]=v,n[3]=0,n[4]=i,n[5]=f,n[6]=d,n[7]=0,n[8]=o,n[9]=s,n[10]=h,n[11]=0,n[12]=-(a*M+i*p+o*y),n[13]=-(c*M+f*p+s*y),n[14]=-(v*M+d*p+h*y),n[15]=1,n)},l.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"},"undefined"!=typeof n&&(n.mat4=l);var d={};d.create=function(){var n=new r(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},d.rotationTo=function(){var n=o.create(),t=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(e,u,a){var i=o.dot(u,a);return i<-.999999?(o.cross(n,t,u),o.length(n)<1e-6&&o.cross(n,r,u),o.normalize(n,n),d.setAxisAngle(e,n,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(n,u,a),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=1+i,d.normalize(e,e))}}(),d.setAxes=function(){var n=v.create();return function(t,r,e,u){return n[0]=e[0],n[3]=e[1],n[6]=e[2],n[1]=u[0],n[4]=u[1],n[7]=u[2],n[2]=-r[0],n[5]=-r[1],n[8]=-r[2],d.normalize(t,d.fromMat3(t,n))}}(),d.clone=c.clone,d.fromValues=c.fromValues,d.copy=c.copy,d.set=c.set,d.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},d.setAxisAngle=function(n,t,r){r=.5*r;var e=Math.sin(r);return n[0]=e*t[0],n[1]=e*t[1],n[2]=e*t[2],n[3]=Math.cos(r),n},d.add=c.add,d.multiply=function(n,t,r){var e=t[0],u=t[1],a=t[2],i=t[3],o=r[0],c=r[1],f=r[2],s=r[3];return n[0]=e*s+i*o+u*f-a*c,n[1]=u*s+i*c+a*o-e*f,n[2]=a*s+i*f+e*c-u*o,n[3]=i*s-e*o-u*c-a*f,n},d.mul=d.multiply,d.scale=c.scale,d.rotateX=function(n,t,r){r*=.5;var e=t[0],u=t[1],a=t[2],i=t[3],o=Math.sin(r),c=Math.cos(r);return n[0]=e*c+i*o,n[1]=u*c+a*o,n[2]=a*c-u*o,n[3]=i*c-e*o,n},d.rotateY=function(n,t,r){r*=.5;var e=t[0],u=t[1],a=t[2],i=t[3],o=Math.sin(r),c=Math.cos(r);return n[0]=e*c-a*o,n[1]=u*c+i*o,n[2]=a*c+e*o,n[3]=i*c-u*o,n},d.rotateZ=function(n,t,r){r*=.5;var e=t[0],u=t[1],a=t[2],i=t[3],o=Math.sin(r),c=Math.cos(r);return n[0]=e*c+u*o,n[1]=u*c-e*o,n[2]=a*c+i*o,n[3]=i*c-a*o,n},d.calculateW=function(n,t){var r=t[0],e=t[1],u=t[2];return n[0]=r,n[1]=e,n[2]=u,n[3]=-Math.sqrt(Math.abs(1-r*r-e*e-u*u)),n},d.dot=c.dot,d.lerp=c.lerp,d.slerp=function(n,t,r,e){var u,a,i,o,c,f=t[0],s=t[1],v=t[2],l=t[3],d=r[0],h=r[1],m=r[2],M=r[3];return a=f*d+s*h+v*m+l*M,a<0&&(a=-a,d=-d,h=-h,m=-m,M=-M),1-a>1e-6?(u=Math.acos(a),i=Math.sin(u),o=Math.sin((1-e)*u)/i,c=Math.sin(e*u)/i):(o=1-e,c=e),n[0]=o*f+c*d,n[1]=o*s+c*h,n[2]=o*v+c*m,n[3]=o*l+c*M,n},d.invert=function(n,t){var r=t[0],e=t[1],u=t[2],a=t[3],i=r*r+e*e+u*u+a*a,o=i?1/i:0;return n[0]=-r*o,n[1]=-e*o,n[2]=-u*o,n[3]=a*o,n},d.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},d.length=c.length,d.len=d.length,d.squaredLength=c.squaredLength,d.sqrLen=d.squaredLength,d.normalize=c.normalize,d.fromMat3=function(n,t){var r,e=t[0]+t[4]+t[8];if(e>0)r=Math.sqrt(e+1),n[3]=.5*r,r=.5/r,n[0]=(t[7]-t[5])*r,n[1]=(t[2]-t[6])*r,n[2]=(t[3]-t[1])*r;else{var u=0;t[4]>t[0]&&(u=1),t[8]>t[3*u+u]&&(u=2);var a=(u+1)%3,i=(u+2)%3;r=Math.sqrt(t[3*u+u]-t[3*a+a]-t[3*i+i]+1),n[u]=.5*r,r=.5/r,n[3]=(t[3*i+a]-t[3*a+i])*r,n[a]=(t[3*a+u]+t[3*u+a])*r,n[i]=(t[3*i+u]+t[3*u+i])*r}return n},d.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},"undefined"!=typeof n&&(n.quat=d)}(t.exports)}(this);
if(glMatrix.setMatrixArrayType(Array),vec3.fromXYZ=function(e){var t=new Array(3);return t[0]=e.x,t[1]=e.y,t[2]=e.z,t},vec3.toXYZ=function(e){return{x:e[0],y:e[1],z:e[2]}},vec4.fromXYZ=function(e,t){var r=new Array(4);return r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t,r},mat4.fromYPR=function(e,t,r){var a=new Array(16),o=Math.sin(r),i=Math.cos(r),n=Math.sin(t),s=Math.cos(t),c=Math.sin(e),v=Math.cos(e);return a[0]=v*i,a[4]=-(v*o),a[8]=c,a[1]=n*c*i+s*o,a[5]=s*i-n*c*o,a[9]=-(n*v),a[2]=n*o-s*c*i,a[6]=n*i+s*c*o,a[10]=s*v,a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},quat.fromYPR=function(e,t,r){var a=.5*r,o=Math.sin(a),i=Math.cos(a),n=.5*t,s=Math.sin(n),c=Math.cos(n),v=.5*e,u=Math.sin(v),l=Math.cos(v),h=new Array(4);return h[0]=l*s*i+u*c*o,h[1]=u*c*i-l*s*o,h[2]=l*c*o-u*s*i,h[3]=l*c*i+u*s*o,h},"undefined"==typeof Phoria||!Phoria){var Phoria={};Phoria.RADIANS=Math.PI/180,Phoria.TWOPI=2*Math.PI,Phoria.ONEOPI=1/Math.PI,Phoria.PIO2=Math.PI/2,Phoria.PIO4=Math.PI/4,Phoria.EPSILON=1e-6}!function(){"use strict";Phoria.Util={},Phoria.Util.extend=function(e,t,r){var a,o=function(){};if(o.prototype=t.prototype,e.prototype=new o,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t),r)for(a in r)r.hasOwnProperty(a)&&(e.prototype[a]=r[a])},Phoria.Util.augment=function(e,t){for(var r in t.prototype)"undefined"==typeof e.prototype[r]&&(e.prototype[r]=t.prototype[r])},Phoria.Util.merge=function(e,t){var r=Array.isArray(t),a=r&&[]||{};return r?(e=e||[],a=a.concat(e),t.forEach(function(t,r){"object"==typeof t?a[r]=Phoria.Util.merge(e[r],t):a[r]=t})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){a[t]=e[t]}),Object.keys(t).forEach(function(r){"object"==typeof t[r]&&t[r]&&e&&e[r]?a[r]=Phoria.Util.merge(e[r],t[r]):a[r]=t[r]})),a},Phoria.Util.combine=function(e,t){var r=Array.isArray(t)&&Array.isArray(e);r?(e.length<t.length&&(e.length=t.length),t.forEach(function(t,r){"object"==typeof t?(e[r]=e[r]||{},Phoria.Util.combine(e[r],t)):e[r]=t})):Object.keys(t).forEach(function(r){"object"==typeof t[r]&&t[r]?(e[r]=e[r]||(Array.isArray(t[r])?[]:{}),Phoria.Util.combine(e[r],t[r])):e[r]=t[r]})},Phoria.Util.clone=function(e){var t=null,r={};for(var a in e)t=e[a],Array.isArray(t)?r[a]=[].concat(t):r[a]=t;return r},Phoria.Util.isIdentity=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},Phoria.Util.calcNormalVector=function(e,t,r,a,o,i){var n=vec4.fromValues(t*i-r*o,-(i*e-a*r),e*o-t*a,0);return vec3.normalize(n,n)},Phoria.Util.thetaTo=function(e,t){return Math.acos(vec3.dot(e,t)/(Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])*Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])))},Phoria.Util.averagePolyVertex=function(e,t){for(var r=0,a=0,o=0,i=0;r<e.length;r++)a+=t[e[r]][0],o+=t[e[r]][1],i+=t[e[r]][2];return vec3.fromValues(a/e.length,o/e.length,i/e.length)},Phoria.Util.averageObjectZ=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r][3];return t/e.length},Phoria.Util.populateBuffer=function(e,t){for(var r=new Array(e),a=0;a<e;a++)r[a]=t(a);return r},Phoria.Util.sortPolygons=function(e,t){for(var r,a=0;a<e.length;a++)r=e[a].vertices,3===r.length?e[a]._avz=.333333*(t[r[0]][2]+t[r[1]][2]+t[r[2]][2]):e[a]._avz=.25*(t[r[0]][2]+t[r[1]][2]+t[r[2]][2]+t[r[3]][2]);e.sort(function(e,t){return e._avz<t._avz?-1:1})},Phoria.Util.sortEdges=function(e,t){for(var r=0;r<e.length;r++)e[r]._avz=.5*(t[e[r].a][2]+t[e[r].b][2]);e.sort(function(e,t){return e._avz<t._avz?-1:1})},Phoria.Util.sortPoints=function(e,t){var r=function e(t,r,a,o){if(a<o){var i=a+o>>1,n=r[i][2],s=a,c=r[i];r[i]=r[o],r[o]=c,c=t[i],t[i]=t[o],t[o]=c;for(var v=a;v<o;v++)r[v][2]>n&&(c=t[v],t[v]=t[s],t[s]=c,c=r[v],r[v]=r[s],r[s]=c,s++);c=t[s],t[s]=t[o],t[o]=c,c=r[s],r[s]=r[o],r[o]=c,e(t,r,a,s-1),e(t,r,s+1,o)}};r(t,e,0,e.length-1)},Phoria.Util.generateTesselatedPlane=function(e,t,r,a,o){for(var i,n=[],s=[],c=[],v=a/t,u=a/e,l=0,h=0,f=a/2;h<=e;h++){i=-a/2;for(var y=0;y<=t;y++){if(n.push({x:i,y:0,z:f}),0!==y&&s.push({a:l,b:l-1}),0!==h&&s.push({a:l,b:l-t-1}),0!==h&&0!==y){var p={vertices:[l-t-1,l,l-1,l-t-2]};if(o){var b=[1/t*y,1/e*(h-1),1/t*y,1/e*h,1/t*(y-1),1/e*h,1/t*(y-1),1/e*(h-1)];p.uvs=b}c.push(p)}i+=v,l++}f-=u}return{points:n,edges:s,polygons:c}},Phoria.Util.generateUnitCube=function(e){var t=e||1;return{points:[{x:-1*t,y:1*t,z:-1*t},{x:1*t,y:1*t,z:-1*t},{x:1*t,y:-1*t,z:-1*t},{x:-1*t,y:-1*t,z:-1*t},{x:-1*t,y:1*t,z:1*t},{x:1*t,y:1*t,z:1*t},{x:1*t,y:-1*t,z:1*t},{x:-1*t,y:-1*t,z:1*t}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:4,b:5},{a:5,b:6},{a:6,b:7},{a:7,b:4},{a:0,b:4},{a:1,b:5},{a:2,b:6},{a:3,b:7}],polygons:[{vertices:[0,1,2,3]},{vertices:[1,5,6,2]},{vertices:[5,4,7,6]},{vertices:[4,0,3,7]},{vertices:[4,5,1,0]},{vertices:[3,2,6,7]}]}},Phoria.Util.generatePyramid=function(e){var t=e||1;return{points:[{x:-1*t,y:0,z:-1*t},{x:-1*t,y:0,z:1*t},{x:1*t,y:0,z:1*t},{x:1*t,y:0*t,z:-1*t},{x:0,y:1.5*t,z:0}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:0,b:4},{a:1,b:4},{a:2,b:4},{a:3,b:4}],polygons:[{vertices:[0,1,4]},{vertices:[1,2,4]},{vertices:[2,3,4]},{vertices:[3,0,4]},{vertices:[3,2,1,0]}]}},Phoria.Util.generateIcosahedron=function(e){var t=e||1,r=(1+Math.sqrt(5))/2,a=r/Math.sqrt(1+r*r)*t,o=1/Math.sqrt(1+r*r)*t;return{points:[{x:a,y:o,z:0},{x:-a,y:o,z:0},{x:-a,y:-o,z:0},{x:a,y:-o,z:0},{x:o,y:0,z:a},{x:o,y:0,z:-a},{x:-o,y:0,z:-a},{x:-o,y:0,z:a},{x:0,y:a,z:o},{x:0,y:-a,z:o},{x:0,y:-a,z:-o},{x:0,y:a,z:-o}],edges:[{a:4,b:8},{a:8,b:7},{a:7,b:4},{a:7,b:9},{a:9,b:4},{a:5,b:6},{a:6,b:11},{a:11,b:5},{a:5,b:10},{a:10,b:6},{a:0,b:4},{a:4,b:3},{a:3,b:0},{a:3,b:5},{a:5,b:0},{a:2,b:7},{a:7,b:1},{a:1,b:2},{a:1,b:6},{a:6,b:2},{a:8,b:0},{a:0,b:11},{a:11,b:8},{a:11,b:1},{a:1,b:8},{a:9,b:10},{a:10,b:3},{a:3,b:9},{a:9,b:2},{a:2,b:10}],polygons:[{vertices:[4,8,7]},{vertices:[4,7,9]},{vertices:[5,6,11]},{vertices:[5,10,6]},{vertices:[0,4,3]},{vertices:[0,3,5]},{vertices:[2,7,1]},{vertices:[2,1,6]},{vertices:[8,0,11]},{vertices:[8,11,1]},{vertices:[9,10,3]},{vertices:[9,2,10]},{vertices:[8,4,0]},{vertices:[11,0,5]},{vertices:[4,9,3]},{vertices:[5,3,10]},{vertices:[7,8,1]},{vertices:[6,1,11]},{vertices:[7,2,9]},{vertices:[6,10,2]}]}},Phoria.Util.subdivide=function(e,t){for(var r,a=[],o=[],i=function(e){var t=e.x*e.x+e.y*e.y+e.z*e.z;t=1/Math.sqrt(t),e.x*=t,e.y*=t,e.z*=t},n=function(e,t,r){var n={x:0,y:0,z:0},s={x:0,y:0,z:0},c={x:0,y:0,z:0};n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z,s.x=t.x+r.x,s.y=t.y+r.y,s.z=t.z+r.z,c.x=r.x+e.x,c.y=r.y+e.y,c.z=r.z+e.z,i(n),i(s),i(c);var v=a.length;a.push(e,t,r,n,s,c),o.push({vertices:[v+0,v+3,v+5]}),o.push({vertices:[v+1,v+4,v+3]}),o.push({vertices:[v+2,v+5,v+4]}),o.push({vertices:[v+3,v+4,v+5]})},s=0;s<t.length;s++)r=t[s].vertices,3===r.length?n.call(this,e[r[0]],e[r[1]],e[r[2]]):4===r.length&&(n.call(this,e[r[0]],e[r[1]],e[r[2]]),n.call(this,e[r[2]],e[r[3]],e[r[0]]));return{points:a,polygons:o}},Phoria.Util.generateCylinder=function(e,t,r){for(var a=[],o=[],i=[],n=2*Math.PI/r,s=0,c=0;s<=r;s++)if(a.push({x:Math.cos(c)*e,z:Math.sin(c)*e,y:t/2}),a.push({x:Math.cos(c)*e,z:Math.sin(c)*e,y:-t/2}),c+=n,0!==s&&(o.push({vertices:[2*s-2,2*s,2*s+1,2*s-1]}),i.push({a:2*s,b:2*s-2},{a:2*s-2,b:2*s-1},{a:2*s+1,b:2*s-1}),s===r-1)){for(var v=[],u=r;u>=0;u--)v.push(2*u);o.push({vertices:v}),v=[];for(var u=0;u<r;u++)v.push(2*u+1);o.push({vertices:v})}return{points:a,edges:i,polygons:o}},Phoria.Util.generateCuboid=function(e){var t=e.scalex||1,r=e.scaley||1,a=e.scalez||1;e.offsetx||0,e.offsety||0,e.offsetz||0;return{points:[{x:-1*t,y:1*r,z:-1*a},{x:1*t,y:1*r,z:-1*a},{x:1*t,y:-1*r,z:-1*a},{x:-1*t,y:-1*r,z:-1*a},{x:-1*t,y:1*r,z:1*a},{x:1*t,y:1*r,z:1*a},{x:1*t,y:-1*r,z:1*a},{x:-1*t,y:-1*r,z:1*a}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:4,b:5},{a:5,b:6},{a:6,b:7},{a:7,b:4},{a:0,b:4},{a:1,b:5},{a:2,b:6},{a:3,b:7}],polygons:[{vertices:[0,1,2,3]},{vertices:[0,4,5,1]},{vertices:[1,5,6,2]},{vertices:[2,6,7,3]},{vertices:[4,0,3,7]},{vertices:[5,4,7,6]}]}},Phoria.Util.generateSphere=function(e,t,r,a){for(var o=[],i=[],n=[],s=[],c=0;c<=t;++c)for(var v=0;v<=r;++v){var u=c*Math.PI/t,l=2*v*Math.PI/r,h=Math.sin(u),f=Math.sin(l),y=Math.cos(u),p=Math.cos(l),b=p*h,g=y,P=f*h;if(a){var x=v/r,d=c/t;s.push({u:x,v:d})}o.push({x:e*b,y:e*g,z:e*P})}for(var c=0;c<t;++c)for(var v=0;v<r;++v){var z=c*(r+1)+v,m=z+r+1;if(0===c){var M={vertices:[z+1,m+1,m]};a&&(M.uvs=[s[z+1].u,s[z+1].v,s[m+1].u,s[m+1].v,s[m].u,s[m].v]),n.push(M),i.push({a:z,b:m})}else if(c===t-1){var M={vertices:[z+1,m,z]};a&&(M.uvs=[s[z+1].u,s[z+1].v,s[m].u,s[m].v,s[z].u,s[z].v]),n.push(M),i.push({a:z,b:m})}else{var M={vertices:[z+1,m+1,m,z]};a&&(M.uvs=[s[z+1].u,s[z+1].v,s[m+1].u,s[m+1].v,s[m].u,s[m].v,s[z].u,s[z].v]),n.push(M),i.push({a:z,b:m}),i.push({a:m,b:m+1})}}return{points:o,edges:i,polygons:n}},Phoria.Util.generateRadialGradientBitmap=function(e,t,r){var a=document.createElement("canvas"),o=e<<1;a.width=a.height=o;var i=a.getContext("2d"),n=i.createRadialGradient(e,e,e>>1,e,e,e);n.addColorStop(0,t),n.addColorStop(1,r),i.fillStyle=n,i.fillRect(0,0,o,o);var s=new Image;return s.src=a.toDataURL("image/png"),s},Phoria.Util.request=function(e){var t=new XMLHttpRequest,r=e.data||"";e.responseContentType&&t.overrideMimeType&&t.overrideMimeType(e.responseContentType),t.open(e.method?e.method:"GET",e.url),e.requestContentType&&t.setRequestHeader("Accept",e.requestContentType),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?e.fnSuccess&&e.fnSuccess.call(this,t.responseText,t.status):e.fnFailure?e.fnFailure.call(this,t.responseText,t.status):alert(t.status+"\n\n"+t.responseText))};try{"POST"===e.method||"PUT"===e.method?t.send(r):t.send(null)}catch(e){alert(e.message)}},Phoria.Util.importGeometryWavefront=function(e){var t,r,a,o,i,n,s=[],c=[],v=[],u=/\s+/,l=e.scale||1;t=r=a=o=i=n=0,Phoria.Util.request({url:e.url,fnSuccess:function(h){for(var f=h.split("\n"),y=0;y<f.length;y++){var p=f[y].split(u);switch(p[0]){case"v":var b=parseFloat(p[1])*l,g=parseFloat(p[2])*l,P=parseFloat(p[3])*l;s.push({x:b,y:g,z:P}),b<t?t=b:b>o&&(o=b),g<r?r=g:g>i&&(i=g),P<a?a=P:P>n&&(n=P);break;case"vt":var x=parseFloat(p[1]),d=parseFloat(p[2]);v.push([x,d]);break;case"f":p.splice(0,1);for(var z,m,M=[],U=[],I=0;I<p.length;I++)if(z=p[e.reorder?p.length-I-1:I],0!==z.length&&(m=z.split("/"),M.push(parseInt(m[0])-1),m.length>1&&z.indexOf("//")===-1)){var A=parseInt(m[1])-1;v.length>A&&U.push(v[A][0],v[A][1])}var T={vertices:M};c.push(T),0!==U.length&&(T.uvs=U)}}if(e.center)for(var V=(t+o)/2,w=(r+i)/2,O=(a+n)/2,y=0;y<s.length;y++)s[y].x-=V,s[y].y-=w,s[y].z-=O;if(e.scaleTo){var q=o-t,S=i-r,F=n-a,C=0;C=S>q?F>S?1/(F/e.scaleTo):1/(S/e.scaleTo):F>q?1/(F/e.scaleTo):1/(q/e.scaleTo);for(var y=0;y<s.length;y++)s[y].x*=C,s[y].y*=C,s[y].z*=C}e.fnSuccess&&e.fnSuccess.call(this,{points:s,polygons:c})},fnFailure:function(t){e.fnFailure&&e.fnFailure.call(this,t)}})},Phoria.Util.calculatePolarFromPlanar=function(e){var t=new vec3.create;return t[0]=vec3.length(e),t[1]=Math.acos(e[2]/t[0]),0!==e[0]?e[0]>0?t[2]=Math.atan(e[1]/e[0]):t[2]=Math.PI+Math.atan(e[1]/e[0]):e[1]>0?t[2]=Math.PI/2:t[2]=3*Math.PI/2,t},Phoria.Util.calculatePlanarFromPolar=function(e){return new vec3.fromValues(Math.round(e[0]*Math.sin(e[1])*Math.cos(e[2])*100)/100,Math.round(e[0]*Math.sin(e[1])*Math.sin(e[2])*100)/100,Math.round(e[0]*Math.cos(e[1])*100)/100)},Phoria.Util.planeLineIntersection=function(e,t,r,a){var o=vec3.dot(r,e);if(0!==o){var i=new vec3.create;vec3.subtract(i,t,a);var n=vec3.dot(e,i)/o,s=vec3.create();return vec3.scaleAndAdd(s,a,r,n),s}return null},Phoria.Util.intersectionInsidePolygon=function(e,t,r){for(var a=vec3.fromValues(Math.abs(e._worldnormal[0]),Math.abs(e._worldnormal[1]),Math.abs(e._worldnormal[2])),o=0,i=vec2.fromValues(1,1),n=0;n<e.vertices.length;n++){var s,c,v;a[2]>=a[0]&&a[2]>=a[1]?(s=vec2.fromValues(t[e.vertices[n]][0],t[e.vertices[n]][1]),c=n<e.vertices.length-1?vec2.fromValues(t[e.vertices[n+1]][0],t[e.vertices[n+1]][1]):vec2.fromValues(t[e.vertices[0]][0],t[e.vertices[0]][1]),v=vec2.fromValues(r[0],r[1])):a[1]>a[0]?(s=vec2.fromValues(t[e.vertices[n]][2],t[e.vertices[n]][0]),c=n<e.vertices.length-1?vec2.fromValues(t[e.vertices[n+1]][2],t[e.vertices[n+1]][0]):vec2.fromValues(t[e.vertices[0]][2],t[e.vertices[0]][0]),v=vec2.fromValues(r[2],r[0])):(s=vec2.fromValues(t[e.vertices[n]][1],t[e.vertices[n]][2]),c=n<e.vertices.length-1?vec2.fromValues(t[e.vertices[n+1]][1],t[e.vertices[n+1]][2]):vec2.fromValues(t[e.vertices[0]][1],t[e.vertices[0]][2]),v=vec2.fromValues(r[1],r[2])),Phoria.Util.sectionLineIntersect2D(s,c,v,i)&&o++}return o%2===1},Phoria.Util.sectionLineIntersect2D=function(e,t,r,a){var o=vec2.create();vec2.subtract(o,t,e);var i=vec3.create();if(vec2.cross(i,o,a),0===i[2])return!1;var n,s=(r[0]*a[1]-r[1]*a[0]-e[0]*a[1]+e[1]*a[0])/i[2];n=0!==a[0]?(e[0]+s*o[0]-r[0])/a[0]:(e[1]+s*o[1]-r[1])/a[1];var c=vec2.create();vec2.scaleAndAdd(c,e,o,s);var v={x:!1,y:!1};return n>=0&&(e[0]>t[0]?c[0]<=e[0]&&c[0]>=t[0]&&(v.x=!0):c[0]>=e[0]&&c[0]<=t[0]&&(v.x=!0),e[1]>t[1]?c[1]<=e[1]&&c[1]>=t[1]&&(v.y=!0):c[1]>=e[1]&&c[1]<=t[1]&&(v.y=!0)),v.x&&v.y}}(),function(){"use strict";Phoria.Preloader=function(){return this.images=[],this},Phoria.Preloader.prototype={images:null,callback:null,counter:0,addImage:function(e,t){var r=this;e.url=t,e.onload=function(){r.counter++,r.counter===r.images.length&&r.callback.call(r)},this.images.push(e)},onLoadCallback:function(e){this.counter=0,this.callback=e;for(var t=0,r=this.images.length;t<r;t++)this.images[t].src=this.images[t].url}}}();
!function(){"use strict";Phoria.BaseEntity=function(){return this.matrix=mat4.create(),this.children=[],this},Phoria.BaseEntity.create=function(t,i){return i||(i=new Phoria.BaseEntity),t.id&&(i.id=t.id),t.matrix&&(i.matrix=t.matrix),t.children&&(i.children=t.children),t.onBeforeScene&&i.onBeforeScene(t.onBeforeScene),t.onScene&&i.onScene(t.onScene),void 0!==t.disabled&&(i.disabled=t.disabled),i},Phoria.BaseEntity.prototype={id:null,children:null,matrix:null,disabled:!1,onBeforeSceneHandlers:null,onSceneHandlers:null,onBeforeScene:function(t){null===this.onBeforeSceneHandlers&&(this.onBeforeSceneHandlers=[]),this.onBeforeSceneHandlers=this.onBeforeSceneHandlers.concat(t)},onScene:function(t){null===this.onSceneHandlers&&(this.onSceneHandlers=[]),this.onSceneHandlers=this.onSceneHandlers.concat(t)},identity:function(){return mat4.identity(this.matrix),this},invert:function(){return mat4.invert(this.matrix,this.matrix),this},multiply:function(t){return mat4.multiply(this.matrix,this.matrix,t),this},scale:function(t){return mat4.scale(this.matrix,this.matrix,t),this},scaleN:function(t){return mat4.scale(this.matrix,this.matrix,vec3.fromValues(t,t,t)),this},rotate:function(t,i){return mat4.rotate(this.matrix,this.matrix,t,i),this},rotateX:function(t){return mat4.rotateX(this.matrix,this.matrix,t),this},rotateY:function(t){return mat4.rotateY(this.matrix,this.matrix,t),this},rotateZ:function(t){return mat4.rotateZ(this.matrix,this.matrix,t),this},rotateYPR:function(t,i,e){var n=mat4.fromYPR(t,i,e);mat4.multiply(this.matrix,this.matrix,n)},translate:function(t){return mat4.translate(this.matrix,this.matrix,t),this},translateX:function(t){return mat4.translate(this.matrix,this.matrix,vec3.fromValues(t,0,0)),this},translateY:function(t){return mat4.translate(this.matrix,this.matrix,vec3.fromValues(0,t,0)),this},translateZ:function(t){return mat4.translate(this.matrix,this.matrix,vec3.fromValues(0,0,t)),this},determinant:function(){return mat4.determinant(this.matrix)},transpose:function(){return mat4.transpose(this.matrix,this.matrix),this}}}(),Phoria.CLIP_ARRAY_TYPE="undefined"!=typeof Uint32Array?Uint32Array:Array,function(){"use strict";Phoria.Entity=function(){return Phoria.Entity.superclass.constructor.call(this),this.points=[],this.edges=[],this.polygons=[],this.textures=[],this.style=Phoria.Entity.createStyle(),this},Phoria.Entity.create=function(t,i){return i||(i=new Phoria.Entity),Phoria.BaseEntity.create(t,i),t.points&&(i.points=t.points),t.polygons&&(i.polygons=t.polygons),t.edges&&(i.edges=t.edges),t.style&&Phoria.Util.combine(i.style,t.style),t.onRender&&i.onRender(t.onRender),i.generatePolygonNormals(),i},Phoria.Entity.createStyle=function(t){var i={color:[128,128,128],diffuse:1,specular:0,drawmode:"solid",shademode:"lightsource",fillmode:"inflate",objectsortmode:"sorted",geometrysortmode:"automatic",linewidth:1,linescale:0,opacity:1,doublesided:!1};return t&&Phoria.Util.combine(i,t),i},Phoria.Util.extend(Phoria.Entity,Phoria.BaseEntity,{points:null,edges:null,polygons:null,style:null,textures:null,onRenderHandlers:null,_worldcoords:null,_cameracoords:null,_coords:null,_clip:null,_averagez:0,_sorted:!0,onRender:function(t){null===this.onRenderHandlers&&(this.onRenderHandlers=[]),this.onRenderHandlers=this.onRenderHandlers.concat(t)},generatePolygonNormals:function(){if(this.polygons)for(var t,i,e,n,o,r,s,a=this.points,l=this.polygons,h=0;h<l.length;h++)t=l[h].vertices,i=a[t[1]].x-a[t[0]].x,e=a[t[1]].y-a[t[0]].y,n=a[t[1]].z-a[t[0]].z,o=a[t[2]].x-a[t[0]].x,r=a[t[2]].y-a[t[0]].y,s=a[t[2]].z-a[t[0]].z,l[h].normal=Phoria.Util.calcNormalVector(i,e,n,o,r,s)},initCoordinateBuffers:function(){var t=this.points.length;if(null===this._worldcoords||this._worldcoords.length<t){this._worldcoords=new Array(t);for(var i=0;i<t;i++)this._worldcoords[i]=vec4.create()}if(null===this._cameracoords||this._cameracoords.length<t){this._cameracoords=new Array(t);for(var i=0;i<t;i++)this._cameracoords[i]=vec4.create()}if(null===this._coords||this._coords.length<t){this._coords=new Array(t);for(var i=0;i<t;i++)this._coords[i]=vec4.create()}(null===this._clip||this._clip.length<t)&&(this._clip=new Phoria.CLIP_ARRAY_TYPE(t))},getScreenBounds:function(){for(var t,i=1e4,e=1e4,n=-1e4,o=-1e4,r=0;r<this._coords.length;r++)t=this._coords[r],t[0]<i&&(i=t[0]),t[0]>n&&(n=t[0]),t[1]<e&&(e=t[1]),t[1]>o&&(o=t[1]);return{minx:i,miny:e,maxx:n,maxy:o}},getWorldBounds:function(){for(var t,i=1e4,e=1e4,n=1e4,o=-1e4,r=-1e4,s=-1e4,a=0;a<this._worldcoords.length;a++)t=this._worldcoords[a],t[0]<i&&(i=t[0]),t[0]>o&&(o=t[0]),t[1]<e&&(e=t[1]),t[1]>r&&(r=t[1]),t[2]<n&&(n=t[2]),t[2]>s&&(s=t[2]);return{minx:i,miny:e,maxx:o,maxy:r,minz:n,maxz:s}}}),Phoria.Entity.debug=function(t,i){for(var e="Phoria.Debug"+(t.id?" "+t.id:""),n=null,o=0;o<t.children.length;o++)if(t.children[o].id===e){n=t.children[o];break}if(null===n){n=new Phoria.Entity,n.id=e,n.points=[{x:0,y:0,z:0}],n.style={drawmode:"point",shademode:"callback",geometrysortmode:"none",objectsortmode:"front"},n.config={},n.onRender(function(i,e,o){i.fillStyle="#333",i.font="14pt Helvetica";var r=o;if(this.config.showId&&(i.fillText(t.id?t.id:"unknown - set Entity 'id' property",e,r),r+=16),this.config.showPosition){var s=t.worldposition?t.worldposition:n._worldcoords[0];i.fillText("{x:"+s[0].toFixed(2)+", y:"+s[1].toFixed(2)+", z:"+s[2].toFixed(2)+"}",e,r)}}),t.children.push(n);var r=function(t,i,e){var n=new Phoria.Entity;return n.points=[{x:0,y:0,z:0},{x:2*i[0],y:2*i[1],z:2*i[2]}],n.edges=[{a:0,b:1}],n.style={drawmode:"wireframe",shademode:"plain",geometrysortmode:"none",objectsortmode:"front",linewidth:2,color:e},n.disabled=!0,n};n.children.push(r("X",vec3.fromValues(1,0,0),[255,0,0])),n.children.push(r("Y",vec3.fromValues(0,1,0),[0,255,0])),n.children.push(r("Z",vec3.fromValues(0,0,1),[0,0,255]))}Phoria.Util.combine(n.config,i);for(var o=0;o<n.children.length;o++)n.children[o].disabled=!n.config.showAxis}}(),function(){"use strict";Phoria.PositionalAspect={},Phoria.PositionalAspect.prototype={position:null,worldposition:null,updatePosition:function(t){var i=vec4.fromXYZ(this.position,1);vec4.transformMat4(i,i,t),this.worldposition=i}}}(),function(){"use strict";Phoria.PhysicsEntity=function(){return Phoria.PhysicsEntity.superclass.constructor.call(this),this.velocity={x:0,y:0,z:0},this.position={x:0,y:0,z:0},this._force={x:0,y:0,z:0},this._acceleration=null,this.gravity=!0,this.onBeforeScene(this.applyPhysics),this.onScene(this.transformToScene),this},Phoria.PhysicsEntity.create=function(t){var i=new Phoria.PhysicsEntity;return Phoria.Entity.create(t,i),t.velocity&&(i.velocity=t.velocity),t.position&&(i.position=t.position),t.force&&(i._force=t.force),void 0!==t.gravity&&(i.gravity=t.gravity),i},Phoria.Util.extend(Phoria.PhysicsEntity,Phoria.Entity,{velocity:null,gravity:!1,_force:null,_acceleration:null,impulse:function(t){this._acceleration=t},force:function(t){this._force=t},applyPhysics:function(t){var i=1e3/60/1e3,e=i*i;this._acceleration&&(this.velocity.x+=this._acceleration.x*e,this.velocity.y+=this._acceleration.y*e,this.velocity.z+=this._acceleration.z*e,this._acceleration=null),this._force&&(this.velocity.x+=this._force.x*e,this.velocity.y+=this._force.y*e,this.velocity.z+=this._force.z*e),this.gravity&&(this.velocity.x+=Phoria.PhysicsEntity.GRAVITY.x*e,this.velocity.y+=Phoria.PhysicsEntity.GRAVITY.y*e,this.velocity.z+=Phoria.PhysicsEntity.GRAVITY.z*e),this.translate(vec3.fromXYZ(this.velocity))},transformToScene:function(t,i){this.updatePosition(i)}}),Phoria.Util.augment(Phoria.PhysicsEntity,Phoria.PositionalAspect)}(),Phoria.PhysicsEntity.GRAVITY={x:0,y:-9.8,z:0},function(){"use strict";Phoria.EmitterEntity=function(){Phoria.EmitterEntity.superclass.constructor.call(this),this.position={x:0,y:0,z:0},this.positionRnd={x:0,y:0,z:0},this.velocity={x:0,y:1,z:0},this.velocityRnd={x:0,y:0,z:0},this.maximum=1e3,this.gravity=!0;var t=Phoria.Entity.createStyle();return t.drawmode="point",t.shademode="plain",t.geometrysortmode="none",t.linewidth=5,t.linescale=2,this.style=t,this.textures=[],this._lastEmitTime=Date.now(),this.onScene(this.emitParticles),this},Phoria.EmitterEntity.create=function(t){var i=new Phoria.EmitterEntity;return Phoria.BaseEntity.create(t,i),t.position&&(i.position=t.position),t.positionRnd&&(i.positionRnd=t.positionRnd),t.rate&&(i.rate=t.rate),t.maximum&&(i.maximum=t.maximum),t.velocity&&(i.velocity=t.velocity),t.velocityRnd&&(i.velocityRnd=t.velocityRnd),t.lifetime&&(i.lifetime=t.lifetime),t.lifetimeRnd&&(i.lifetimeRnd=t.lifetimeRnd),void 0!==t.gravity&&(i.gravity=t.gravity),t.style&&Phoria.Util.combine(i.style,t.style),t.onParticle&&i.onParticle(t.onParticle),i},Phoria.Util.extend(Phoria.EmitterEntity,Phoria.BaseEntity,{style:null,rate:0,maximum:0,velocity:null,velocityRnd:null,lifetime:0,lifetimeRnd:0,gravity:!1,_lastEmitTime:0,onParticleHandlers:null,onParticle:function(t){null===this.onParticleHandlers&&(this.onParticleHandlers=[]),this.onParticleHandlers=this.onParticleHandlers.concat(t)},emitParticles:function(t,i,e){this.updatePosition(i);for(var n,o=Date.now(),r=0;r<this.children.length;r++)n=this.children[r],n._gravetime&&o>n._gravetime&&this.children.splice(r,1);var s=o-this._lastEmitTime,a=Math.floor(this.rate/1e3*s);if(a>0){for(var l=0;l<a&&(0===this.maximum||this.children.length<this.maximum);l++){var h={x:this.position.x,y:this.position.y,z:this.position.z};h.x+=Math.random()*this.positionRnd.x-.5*this.positionRnd.x,h.y+=Math.random()*this.positionRnd.y-.5*this.positionRnd.y,h.z+=Math.random()*this.positionRnd.z-.5*this.positionRnd.z;var c={x:this.velocity.x,y:this.velocity.y,z:this.velocity.z};c.x+=Math.random()*this.velocityRnd.x-.5*this.velocityRnd.x,c.y+=Math.random()*this.velocityRnd.y-.5*this.velocityRnd.y,c.z+=Math.random()*this.velocityRnd.z-.5*this.velocityRnd.z;var d=new Phoria.PhysicsEntity;if(d.position=h,d.points=[h],d.velocity=c,d.gravity=this.gravity,d.style=this.style,d.textures=this.textures,0!==this.lifetime&&(d._gravetime=Math.floor(o+this.lifetime+this.lifetimeRnd*Math.random()-.5*this.lifetimeRnd)),null!==this.onParticleHandlers)for(var u=0;u<this.onParticleHandlers.length;u++)this.onParticleHandlers[u].call(this,d);this.children.push(d)}this._lastEmitTime=o}}}),Phoria.Util.augment(Phoria.EmitterEntity,Phoria.PositionalAspect)}(),function(){"use strict";Phoria.BaseLight=function(){return Phoria.BaseLight.superclass.constructor.call(this),this.color=[1,1,1],this.intensity=1,this},Phoria.Util.extend(Phoria.BaseLight,Phoria.BaseEntity,{color:null,intensity:0})}(),function(){"use strict";Phoria.DistantLight=function(){return Phoria.DistantLight.superclass.constructor.call(this),this.direction={x:0,y:0,z:1},this.onScene(this.transformToScene),this},Phoria.DistantLight.create=function(t){var i=new Phoria.DistantLight;return Phoria.BaseEntity.create(t,i),t.color&&(i.color=t.color),t.intensity&&(i.intensity=t.intensity),t.direction&&(i.direction=vec3.toXYZ(vec3.normalize(i.direction,vec3.fromXYZ(t.direction)))),i},Phoria.Util.extend(Phoria.DistantLight,Phoria.BaseLight,{direction:null,worlddirection:null,transformToScene:function(){this.worlddirection=vec3.fromValues(-this.direction.x,-this.direction.y,-this.direction.z)}})}(),function(){"use strict";Phoria.PointLight=function(){return Phoria.PointLight.superclass.constructor.call(this),this.position={x:0,y:0,z:-1},this.attenuation=.1,this.attenuationFactor="linear",this.onScene(this.transformToScene),this},Phoria.PointLight.create=function(t){var i=new Phoria.PointLight;return Phoria.BaseEntity.create(t,i),t.color&&(i.color=t.color),t.intensity&&(i.intensity=t.intensity),t.position&&(i.position=t.position),t.attenuation&&(i.attenuation=t.attenuation),t.attenuationFactor&&(i.attenuationFactor=t.attenuationFactor),i},Phoria.Util.extend(Phoria.PointLight,Phoria.BaseLight,{attenuation:0,attenuationFactor:null,transformToScene:function(t,i,e){this.updatePosition(i)}}),Phoria.Util.augment(Phoria.PointLight,Phoria.PositionalAspect)}();
!function(){"use strict";Phoria.Scene=function(){return this.camera={up:{x:0,y:1,z:0},lookat:{x:0,y:0,z:0},position:{x:0,y:0,z:-10}},this.perspective={fov:35,aspect:1,near:1,far:1e4},this.viewport={x:0,y:0,width:1024,height:1024},this.graph=[],this.triggerHandlers=[],this},Phoria.Scene.create=function(e){var r=new Phoria.Scene;return e.camera&&(r.camera=Phoria.Util.merge(r.camera,e.camera)),e.perspective&&(r.perspective=Phoria.Util.merge(r.perspective,e.perspective)),e.viewport&&(r.viewport=Phoria.Util.merge(r.viewport,e.viewport)),e.graph&&(r.graph=e.graph),e.onCamera&&r.onCamera(e.onCamera),r},Phoria.Scene.createFromJSON=function(e){var r=null,t=JSON.parse(e);if(t&&t.graph){var a=function(e){for(var r,t=0;t<e.length;t++){r=e[t];for(var i in r)if(r.hasOwnProperty(i)){if(0===i.indexOf("on")&&(r[i]instanceof string||r[i]instanceof Array))try{}catch(e){throw console.log("Failed to convert expected event handler to function: "+i+"="+r[i]),e}"children"===i&&r[i]instanceof Array&&a(r[i])}}};a(t.graph)}return r},Phoria.Scene.toJSON=function(e){for(var r in e)e.hasOwnProperty(r)&&0===r.indexOf("_")&&delete e[r];if(e.graph){var t=function(e){for(var r,a=0;a<e.length;a++){r=e[a];for(var i in r)if(r.hasOwnProperty(i))switch(0===i.indexOf("on")&&r[i]instanceof Array&&(r[i]=r[i].toString()),0===i.indexOf("_")&&delete r[i],i){case"textures":delete r[i];break;case"children":r[i]instanceof Array&&t(r[i])}}};t(e.graph)}return JSON.stringify(e)},Phoria.Scene.prototype={camera:null,perspective:null,graph:null,viewport:null,renderlist:null,lights:null,triggerHandlers:null,onCameraHandlers:null,_entities:null,_lastTime:0,_cameraPosition:null,_perspectiveScale:0,findEntity:function(e){return this._entities[e]},onCamera:function(e){null===this.onCameraHandlers&&(this.onCameraHandlers=[]),this.onCameraHandlers=this.onCameraHandlers.concat(e)},modelView:function(){var e=Date.now(),r=(e-this._lastTime)/1e3;this._lastTime=e;var t=this.viewport.x,a=this.viewport.y,i=.5*this.viewport.width,o=.5*this.viewport.height;this._cameraPosition=vec4.fromValues(this.camera.position.x,this.camera.position.y,this.camera.position.z,0);var s=mat4.create(),n=vec4.fromValues(this.camera.lookat.x,this.camera.lookat.y,this.camera.lookat.z,0),l=vec4.fromValues(this.camera.up.x,this.camera.up.y,this.camera.up.z,0);if(null!==this.onCameraHandlers)for(var c=0;c<this.onCameraHandlers.length;c++)this.onCameraHandlers[c].call(this,this._cameraPosition,n,l);mat4.lookAt(s,this._cameraPosition,n,l);var h=mat4.create();mat4.perspective(h,-this.perspective.fov*Phoria.RADIANS,this.perspective.aspect,this.perspective.near,this.perspective.far),this._perspectiveScale=(256-this.perspective.fov)/16;var d=[],p=[],m={},f=function(e,n){for(var l,c,v=0;v<e.length;v++)if(l=e[v],!l.disabled){if(l.id&&(m[l.id]=l),null!==l.onBeforeSceneHandlers)for(var g=0;g<l.onBeforeSceneHandlers.length;g++)l.onBeforeSceneHandlers[g].call(l,this,r);var u=l.matrix;if(n&&(u=u?mat4.multiply(mat4.create(),u,n):n),null!==l.onSceneHandlers)for(var g=0;g<l.onSceneHandlers.length;g++)l.onSceneHandlers[g].call(l,this,u,r);if(l instanceof Phoria.BaseLight)p.push(l);else if(l instanceof Phoria.Entity){c=l.points.length,l.initCoordinateBuffers();var y=0,w=0;"point"===l.style.drawmode&&(w=0===l.style.linescale?.5*l.style.linewidth:l.style.linewidth*l.style.linescale/this._perspectiveScale*.5);for(var _,P,S,H=0,x=0;H<c;H++)_=l.points[H],P=vec4.set(l._worldcoords[H],_.x,_.y,_.z,1),u&&vec4.transformMat4(l._worldcoords[H],P,u),vec4.transformMat4(l._cameracoords[H],l._worldcoords[H],s),vec4.transformMat4(l._coords[H],l._cameracoords[H],h),P=l._coords[H],S=P[3],0===S&&(S=Phoria.EPSILON),y+=l._clip[H]=P[0]>S+w||P[0]<-S-w||P[1]>S+w||P[1]<-S-w||P[2]>S||P[2]<-S?1:0,P[0]/=S,P[1]/=S,P[0]=i*P[0]+t+i,P[1]=o*P[1]+a+o,x+=P[2];if(l._averagez=c>1?x/c:x,y!==c){switch(l.style.geometrysortmode){default:case"automatic":case"sorted":if("sorted"===l.style.geometrysortmode||"solid"===l.style.drawmode||"lightsource"===l.style.shademode)switch(l.style.drawmode){case"solid":Phoria.Util.sortPolygons(l.polygons,l._cameracoords);break;case"wireframe":Phoria.Util.sortEdges(l.edges,l._cameracoords);break;case"point":Phoria.Util.sortPoints(l._coords,l._worldcoords)}}if("solid"===l.style.drawmode&&0!==l.polygons.length){var C=mat4.invert(mat4.create(),u?u:mat4.create());switch(mat4.transpose(C,C),l.style.shademode){case"lightsource":for(var O,z,k=0;k<l.polygons.length;k++)l.polygons[k]._worldnormal||(l.polygons[k]._worldnormal=vec4.create()),O=l.polygons[k].normal,z=l.polygons[k]._worldnormal,vec3.transformMat4(z,O,C),vec3.normalize(z,z)}}d.push(l)}}l.children&&0!==l.children.length&&f.call(this,l.children,u)}};f.call(this,this.graph,null),this.renderlist=d,this.lights=p,this._entities=m;for(var v=0,g=this.triggerHandlers.length;v<g;v++)this.triggerHandlers[v].trigger.call(this,this._cameraPosition,n,l)&&(this.triggerHandlers.splice(v,1),g--)}}}();
!function(){"use strict";Phoria.Renderer=function(){},Phoria.Renderer.prototype={sort:!0,sortObjects:function(e){if(this.sort){for(var t,i=0;i<e.renderlist.length;i++)switch(t=e.renderlist[i],t.style.objectsortmode){case"sorted":break;case"front":t._averagez=Number.MIN_VALUE;break;case"back":default:t._averagez=Number.MAX_VALUE}e.renderlist.sort(function(e,t){return e._averagez<t._averagez?1:-1})}},calcNormalBrightness:function(e,t,i,a){for(var r,l,s=[0,0,0],o=i.lights,n=0;n<o.length;n++){if(r=o[n],r instanceof Phoria.DistantLight){var h=vec3.dot(t,r.worlddirection);if(h<=0)continue;l=h*r.intensity*a.style.diffuse}else if(r instanceof Phoria.PointLight){var c,d=vec3.subtract(vec3.create(),e,r.worldposition),v=vec3.length(d);vec3.normalize(d,d);var h=vec3.dot(t,vec3.negate(d,d));if(h<=0)continue;switch(r.attenuationFactor){default:case"none":c=r.attenuation;break;case"linear":c=r.attenuation*v;break;case"squared":c=r.attenuation*v*v}if(0!==a.style.specular){var g=vec3.add(vec3.create(),d,i._cameraPosition),u=vec3.dot(t,vec3.normalize(g,g)),f=Math.pow(u,a.style.specular)*r.intensity/c;s[0]+=f*r.color[0],s[1]+=f*r.color[1],s[2]+=f*r.color[2]}l=a.style.diffuse*h*r.intensity/c}s[0]+=l*r.color[0],s[1]+=l*r.color[1],s[2]+=l*r.color[2]}return s},calcPositionBrightness:function(e,t){for(var i,a,r=[0,0,0],l=0;l<t.length;l++){if(i=t[l],i instanceof Phoria.DistantLight)a=i.intensity;else if(i instanceof Phoria.PointLight){var s,o=vec3.subtract(vec3.create(),e,i.worldposition),n=vec3.length(o);switch(vec3.normalize(o,o),i.attenuationFactor){case"linear":s=i.attenuation*n;break;case"squared":s=i.attenuation*n*n;break;default:case"none":s=i.attenuation}a=i.intensity/(2*s)}r[0]+=a*i.color[0],r[1]+=a*i.color[1],r[2]+=a*i.color[2]}return r},inflatePolygon:function(e,t,i){i=i||.5;for(var a=new Array(e.length),r=0;r<e.length;r++)a[r]=[t[e[r]][0],t[e[r]][1]];for(var l,s,o,n,h,r=0,c=e.length;r<c;r++){l=r<c-1?r+1:0,s=a[r][0],o=a[r][1],n=a[l][0],h=a[l][1];var d,v=n-s,g=h-o,u=v*v+g*g;0===u&&u===Phoria.EPSILON,d=i/Math.sqrt(u),v*=d,g*=d,a[r][0]-=v,a[r][1]-=g,a[l][0]+=v,a[l][1]+=g}return a},inflatePolygonFull:function(e,t,i){i=i||.5;for(var a,r,l,s,o,n,h,c=[],d=new Array(e.length),v=0,g=e.length;v<g;v++)a=t[e[v]][0],r=t[e[v]][1],v<g-1?(l=t[e[v+1]][0],s=t[e[v+1]][1]):(l=t[e[0]][0],s=t[e[0]][1]),o=s-r,n=-(l-a),h=Math.sqrt(o*o+n*n),o/=h,n/=h,o*=i,n*=i,c.push({x:a+o,y:r+n}),c.push({x:l+o,y:s+n});for(var u,v=0,g=e.length;v<g;v++)u=0===v?this.intersection(c[2*(g-1)],c[2*(g-1)+1],c[0],c[1]):this.intersection(c[2*(v-1)],c[2*(v-1)+1],c[2*v],c[2*v+1]),(Math.abs(u[0]-t[e[v]][0])>1.5||Math.abs(u[1]-t[e[v]][1])>1.5)&&(u[0]=t[e[v]][0],u[1]=t[e[v]][1]),d[v]=u;return d},intersection:function(e,t,i,a){var r=t.x-e.x,l=i.x-a.x,s=i.x-e.x,o=t.y-e.y,n=i.y-a.y,h=i.y-e.y,c=(l*h-n*s)/(o*l-r*n);return[e.x+c*(t.x-e.x),e.y+c*(t.y-e.y)]}}}(),function(){"use strict";Phoria.CanvasRenderer=function(e){return Phoria.CanvasRenderer.superclass.constructor.call(this),this.canvas=e,this.ctx=e.getContext("2d"),this},Phoria.Util.extend(Phoria.CanvasRenderer,Phoria.Renderer,{canvas:null,ctx:null,render:function(e,t){this.sortObjects(e);var i=this.ctx;t?t.call(this,i):i.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a,r=0;r<e.renderlist.length;r++){switch(a=e.renderlist[r],i.save(),a.style.compositeOperation&&(i.globalCompositeOperation=a.style.compositeOperation),a.style.drawmode){case"solid":"fillstroke"!==a.style.fillmode&&"hiddenline"!==a.style.fillmode||(i.lineWidth=1);for(var l=0;l<a.polygons.length;l++)this.renderPolygon(i,a,e,a.polygons[l]);break;case"wireframe":if(i.lineWidth=a.style.linewidth,i.globalAlpha=a.style.opacity,"plain"===a.style.shademode){i.strokeStyle="rgb("+a.style.color[0]+","+a.style.color[1]+","+a.style.color[2]+")",i.beginPath();for(var l=0;l<a.edges.length;l++)this.renderEdge(i,a,e,a.edges[l]);i.closePath(),i.stroke()}else for(var l=0;l<a.edges.length;l++)this.renderEdge(i,a,e,a.edges[l]);break;case"point":if("sprite"===a.style.shademode&&void 0!==a.style.sprite){if(!a.textures)throw new Error("Entity has shademode 'sprite' but no textures defined on parent emitter.");if(a.style.sprite>a.textures.length-1)throw new Error("Entity has shademode 'sprite' index but references missing texture on parent emitter.")}i.globalAlpha=a.style.opacity;var s=a._coords;"plain"===a.style.shademode&&(i.fillStyle="rgb("+a.style.color[0]+","+a.style.color[1]+","+a.style.color[2]+")");for(var l=0;l<s.length;l++)this.renderPoint(i,a,e,s[l],l)}i.restore()}},renderPoint:function(e,t,i,a,r){if(!t._clip[r]){var l=t.style.linewidth;switch(0!==t.style.linescale&&(l=t.style.linewidth*t.style.linescale*i._perspectiveScale/t._coords[r][3]),t.style.shademode){case"plain":e.beginPath(),e.arc(a[0],a[1],l,0,Phoria.TWOPI,!0),e.closePath(),e.fill();break;case"sprite":void 0!==t.style.sprite&&e.drawImage(t.textures[t.style.sprite],a[0]-l,a[1]-l,l+l,l+l);break;case"callback":if(null!==t.onRenderHandlers)for(var s=0;s<t.onRenderHandlers.length;s++)t.onRenderHandlers[s].call(t,e,a[0],a[1],l);break;case"lightsource":var o=this.calcPositionBrightness(t._worldcoords[r],i.lights);e.fillStyle="rgb("+Math.min(Math.ceil(o[0]*t.style.color[0]),255)+","+Math.min(Math.ceil(o[1]*t.style.color[1]),255)+","+Math.min(Math.ceil(o[2]*t.style.color[2]),255)+")",e.beginPath(),e.arc(a[0],a[1],l,0,Phoria.TWOPI,!0),e.closePath(),e.fill()}}},renderEdge:function(e,t,i,a){if(!(t._clip[a.a]&t._clip[a.b])){var r=t._coords;if(0!==t.style.linescale&&(e.lineWidth=t.style.linewidth*t.style.linescale/(.5*(t._coords[a.a][3]+t._coords[a.b][3]))*i._perspectiveScale),"lightsource"===t.style.shademode){var l=t._worldcoords[a.a],s=t._worldcoords[a.b],o=vec3.fromValues(.5*(l[0]+s[0]),.5*(l[1]+s[1]),.5*(l[2]+s[2])),n=this.calcPositionBrightness(o,i.lights);e.beginPath(),e.strokeStyle="rgb("+Math.min(Math.ceil(n[0]*t.style.color[0]),255)+","+Math.min(Math.ceil(n[1]*t.style.color[1]),255)+","+Math.min(Math.ceil(n[2]*t.style.color[2]),255)+")",e.moveTo(r[a.a][0],r[a.a][1]),e.lineTo(r[a.b][0],r[a.b][1]),e.closePath(),e.stroke()}else e.moveTo(r[a.a][0],r[a.a][1]),e.lineTo(r[a.b][0],r[a.b][1])}},renderPolygon:function(e,t,i,a){for(var r,l=t._coords,s=t._clip,o=a.vertices,n=a.color?a.color:t.style.color,h=null,c=0,d=a.opacity?a.opacity:t.style.opacity,v=1,g=0;g<o.length;g++)v&=s[o[g]];if(!v&&(t.style.doublesided||!(l[o[0]][0]*l[o[1]][1]-l[o[1]][0]*l[o[0]][1]+(l[o[1]][0]*l[o[2]][1]-l[o[2]][0]*l[o[1]][1])+(l[o[2]][0]*l[o[0]][1]-l[o[0]][0]*l[o[2]][1])<0))){switch(t.style.shademode){case"plain":void 0===t.style.texture&&void 0===a.texture&&(h=n[0]+","+n[1]+","+n[2]);break;case"lightsource":r=this.calcNormalBrightness(Phoria.Util.averagePolyVertex(o,t._worldcoords),a._worldnormal,i,t),(a.emit||t.style.emit)&&(c=a.emit?a.emit:t.style.emit),h=Math.min(Math.ceil(r[0]*n[0]+n[0]*c),255)+","+Math.min(Math.ceil(r[1]*n[1]+n[1]*c),255)+","+Math.min(Math.ceil(r[2]*n[2]+n[1]*c),255)}if(e.save(),void 0!==t.style.texture||void 0!==a.texture){var u,f,y,m,w,P,b=t.textures[void 0!==a.texture?a.texture:t.style.texture],p=function(t,i,a,r,l,s,o){var n=t[0][0],h=t[0][1],c=t[1][0],v=t[1][1],g=t[2][0],u=t[2][1];e.beginPath(),e.moveTo(n,h),e.lineTo(c,v),e.lineTo(g,u),e.closePath(),e.clip();var f=1/(i*(o-l)-r*o+s*l+(r-s)*a),y=-(a*(g-c)-l*g+o*c+(l-o)*n)*f,m=(l*u+a*(v-u)-o*v+(o-l)*h)*f,w=(i*(g-c)-r*g+s*c+(r-s)*n)*f,P=-(r*u+i*(v-u)-s*v+(s-r)*h)*f,p=(i*(o*c-l*g)+a*(r*g-s*c)+(s*l-r*o)*n)*f,x=(i*(o*v-l*u)+a*(r*u-s*v)+(s*l-r*o)*h)*f;e.transform(y,m,w,P,p,x),e.globalAlpha=d,e.drawImage(b,0,0)};if(null!==h){var x=.3*r[0]+.6*r[1]+.1*r[2];x>1&&(x=1),e.fillStyle="rgba("+h+","+(1-x).toFixed(3)+")"}if(3===o.length){u=0,f=0,y=b.width,m=0,w=b.width,P=b.height,void 0!==a.uvs&&(u=b.width*a.uvs[0],f=b.height*a.uvs[1],y=b.width*a.uvs[2],m=b.height*a.uvs[3],w=b.width*a.uvs[4],P=b.height*a.uvs[5]);var M=this.inflatePolygon(o,l,.5);p.call(this,M,u,f,y,m,w,P),null!==h&&e.fill()}else if(4===o.length){u=0,f=0,y=b.width,m=0,w=b.width,P=b.height,void 0!==a.uvs&&(u=b.width*a.uvs[0],f=b.height*a.uvs[1],y=b.width*a.uvs[2],m=b.height*a.uvs[3],w=b.width*a.uvs[4],P=b.height*a.uvs[5]),e.save();var M=this.inflatePolygon(o.slice(0,3),l,.5);p.call(this,M,u,f,y,m,w,P),e.restore(),u=b.width,f=b.height,y=0,m=b.height,w=0,P=0,void 0!==a.uvs&&(u=b.width*a.uvs[4],f=b.height*a.uvs[5],y=b.width*a.uvs[6],m=b.height*a.uvs[7],w=b.width*a.uvs[0],P=b.height*a.uvs[1]),e.save();var _=new Array(3);if(_[0]=o[2],_[1]=o[3],_[2]=o[0],M=this.inflatePolygon(_,l,.5),p.call(this,M,u,f,y,m,w,P),e.restore(),null!==h){M=this.inflatePolygon(o,l,.75),e.beginPath(),e.moveTo(M[0][0],M[0][1]);for(var g=1,k=M.length;g<k;g++)e.lineTo(M[g][0],M[g][1]);e.closePath(),e.globalAlpha=d,e.fill()}}}else{if("inflate"===t.style.fillmode){var M=this.inflatePolygon(o,l,.5);e.beginPath(),e.moveTo(M[0][0],M[0][1]);for(var g=1,k=o.length;g<k;g++)e.lineTo(M[g][0],M[g][1]);e.closePath()}else{e.beginPath(),e.moveTo(l[o[0]][0],l[o[0]][1]);for(var g=1;g<o.length;g++)e.lineTo(l[o[g]][0],l[o[g]][1]);e.closePath()}switch(h="rgba("+h+","+d+")",t.style.fillmode){case"fill":e.fillStyle=h,e.fill();break;case"filltwice":e.fillStyle=h,e.fill(),e.fill();break;case"inflate":e.fillStyle=h,e.fill();break;case"fillstroke":e.fillStyle=h,e.fill(),e.strokeStyle=h,e.stroke();break;case"hiddenline":e.strokeStyle=h,e.stroke()}}e.restore()}},renderImage:function(e,t,i,a,r,l){l=l||1;var s=this.canvas.width/a,o=this.canvas.height/r,n=Math.min(s,o);this.ctx.save(),this.ctx.globalAlpha=l,this.ctx.drawImage(e,t,i,a*n,r*n),this.ctx.restore()}})}(),function(){"use strict";Phoria.SoftwareRenderer=function(e){return Phoria.SoftwareRenderer.superclass.constructor.call(this),this.canvas=e,this.ctx=e.getContext("2d"),this._imagedata=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this._data=this._imagedata.data,this},Phoria.Util.extend(Phoria.SoftwareRenderer,Phoria.Renderer,{canvas:null,ctx:null,_imagedata:null,_data:null,render:function(e){this.sortObjects(e),this.clearCanvasRect(0,0,this.canvas.width,this.canvas.height);for(var t,i=0;i<e.renderlist.length;i++)switch(t=e.renderlist[i],t.style.drawmode){case"solid":for(var a=0,r=0;r<t.polygons.length;r++)this.renderPolygon(null,t,e,t.polygons[r])&&a++}this.ctx.putImageData(this._imagedata,0,0,0,0,this.canvas.width,this.canvas.height)},clearCanvasRect:function(e,t,i,a){for(var r=4*(e+t*this.canvas.width-1)+3,l=4*(this.canvas.width-(i-e)),s=this._data,o=t;o<a;o++){for(var n=e;n<i;n++)s[r+=4]=0;r+=l}},renderPolygon:function(e,t,i,a){for(var r=t._coords,l=t._clip,s=a.vertices,o=a.color?a.color:t.style.color,n=1,h=0;h<s.length;h++)n&=l[s[h]];if(n)return!1;if(t.style.doublesided||!(r[s[0]][0]*r[s[1]][1]-r[s[1]][0]*r[s[0]][1]+(r[s[1]][0]*r[s[2]][1]-r[s[2]][0]*r[s[1]][1])+(r[s[2]][0]*r[s[0]][1]-r[s[0]][0]*r[s[2]][1])<0)){var c;switch(t.style.shademode){case"plain":c=new Array(3),c[0]=o[0],c[1]=o[1],c[2]=o[2];break;case"lightsource":c=this.calcNormalBrightness(Phoria.Util.averagePolyVertex(s,t._worldcoords),a._worldnormal,i,t),c[0]=Math.ceil(Math.min(c[0]*o[0],255)),c[1]=Math.ceil(Math.min(c[1]*o[1],255)),c[2]=Math.ceil(Math.min(c[2]*o[2],255))}return this.drawTriangle(r[s[2]][0],r[s[2]][1],r[s[1]][0],r[s[1]][1],r[s[0]][0],r[s[0]][1],c[0],c[1],c[2]),4===s.length&&this.drawTriangle(r[s[0]][0],r[s[0]][1],r[s[3]][0],r[s[3]][1],r[s[2]][0],r[s[2]][1],c[0],c[1],c[2]),!0}},drawTriangle:function(e,t,i,a,r,l,s,o,n){var e=Math.round(16*e),i=Math.round(16*i),r=Math.round(16*r),t=Math.round(16*t),a=Math.round(16*a),l=Math.round(16*l),h=e-i,c=i-r,d=r-e,v=t-a,g=a-l,u=l-t,f=h<<4,y=c<<4,m=d<<4,w=v<<4,P=g<<4,b=u<<4,p=this.canvas.width,x=this.canvas.height,M=this._data,_=Math.max(Math.min(e,i,r)+15>>4,0),k=Math.min(Math.max(e,i,r)+15>>4,p),T=Math.max(Math.min(t,a,l)+15>>4,0),S=Math.min(Math.max(t,a,l)+15>>4,x);if(!(k<=_||S<=T)){var R=v*e-h*t,A=g*i-c*a,E=u*r-d*l;(v<0||0==v&&h>0)&&R++,(g<0||0==g&&c>0)&&A++,(u<0||0==u&&d>0)&&E++;for(var I,O,C,z,L,N=R+h*(T<<4)-v*(_<<4),B=A+c*(T<<4)-g*(_<<4),U=E+d*(T<<4)-u*(_<<4),V=T;V<S;V++){for(I=N,O=B,C=U,z=_;z<k;z++)I>0&&O>0&&C>0&&(L=z+V*p<<2,M[L]=s,M[L+1]=o,M[L+2]=n,M[L+3]=255),I-=w,O-=P,C-=b;N+=f,B+=y,U+=m}}}})}();